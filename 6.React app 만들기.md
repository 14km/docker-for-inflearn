# React APP을 구현 해보자.

## React

- 설치를 해보자

```docker
# 원하는 dir에 설치하기 위함.
npx create-react-app ./
```

- 설치 후 `npm run start`, `npm run build` 등.. 다양한 방식으로 실행이 가능하다.

## Docker를 이용하여 React를 실행해보자!

- 도커파일을 dev용, prod용으로 분리하여 사용하는 것이 좋다.
- detail한 설정을 할 수 있기 때문에..

### package.json 을 먼저 한다..

```docker
FROM node:aline

WORKDIR /usr/src/app

COPY package.json ./

RUN npm install

COPY ./ ./

CMD ["npm", "run", "start"]
```

- 불필요한 종속성때문에, 다음과 같이 설정해야한다.

### 도커 파일을 빌드하자!

```docker
# Dockerfile.dev

docker build -t connor/node:1.0.0 Dockerfile.dev

...

unable to prepare context: context must be a directory
Dockerfile  
```

→ 빌드를 해보니.. 오류가 발생된다.

→ 원래 이미지를 빌드할 때 해당 디렉토리만 Dockerfile을 스스로 찾아 빌드를 해주는데..

→ Dockerfile을 정확히 찾지 못하여 에러가 발생된 건이다.

→ `docker build -t connor/node:1.0.0 -f Dockerfile.dev ./`

### docker build -f 를 통해서 한다.

```docker
# Dockerfile.dev를 빌드한다.
docker build -t connor/node:1.0.0 -f Dockerfile.dev ./
```

→ 다음과 같이 빌드가 가능해진다.

### node_modules 를 지워도 괜찮다.

```docker
#Dockerfile 내에 파일 내용중..

...

COPY package.json ./

RUN npm install

COPY ./ ./

...
```

→ npm install 에서 node_modules가 설치된다.

→ 기존 react app을 설치할때 자동으로.. 반영되어 있으므로 즉, 로컬은 지워도된다.

---

## 만들었으니, 실행해보자!

```docker
docker run connor/node:1.0.0                          

....

> react-node@0.1.0 start
> react-scripts start

(0 , _schemaUtils.default) is not a function
npm ERR! code 1
npm ERR! path /usr/src/app
npm ERR! command failed
npm ERR! command sh -c react-scripts start
```

→ 에러가 발생되는데.. `node_modules`가 겹쳐 있는 경우 동일하게 설치 후 `COPY ./ ./` 복사되므로... 오류가 발생된다.

→ 지우고 해결이 완료됨!

### Server는 실행되나.. port 문제가 또 발생된다!

```docker
docker run -p 3000:3000 connor/node:1.0.3

# ... or

docker run -p 3000:3000 -it connor/node:1.0.3
```

→ -i : 상호 입출력

→ -t : tty를 활성화 하여 bash 쉘을 사용한다.

---

## COPY와 Volume 차이 복습해보자!

- COPY : 로컬의 파일을 도커에 복사하는 것이다.
- Volume : 로컬 머신의 파일을 매핑을 참조하는 것이다.

```docker
docker run -p 3000:3000 -it -v /usr/src/app/node_modules -v $(pwd):/usr/src/app <image>
```

→ `-v /usr/src/app/node_modules` 이부분은 호스트 디렉토리에 컨테이너 매핑을 하지 않는것.
→ 이유는.. 위에서 `node_modules` 를 제거했다.
